<!doctype html><html lang=en><head><title>HTTP Strict Transport Security (HSTS) & Preloading :: JenkinsDev :: Into the mind of an aspiring polymathic autodidact.</title>
<meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Your end-users are still very much susceptible to &#34;man-in-the-middle&#34; attacks which could leave them vulnerable to phishing and eavesdropping..."><meta name=keywords content="technology coding programming software development creativity work family life everything"><meta name=robots content="noodp"><link rel=canonical href=/posts/http-strict-transport-security-and-preloading/><link rel=stylesheet href=/assets/style.css><link rel=stylesheet href=/assets/blue.css><link rel=apple-touch-icon href=/img/apple-touch-icon-192x192.png><link rel="shortcut icon" href=/img/favicon/blue.png><meta name=twitter:card content="summary"><meta name=twitter:site content="jenkinsdev.github.io"><meta name=twitter:creator content><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="HTTP Strict Transport Security (HSTS) & Preloading"><meta property="og:description" content="Your end-users are still very much susceptible to &#34;man-in-the-middle&#34; attacks which could leave them vulnerable to phishing and eavesdropping..."><meta property="og:url" content="/posts/http-strict-transport-security-and-preloading/"><meta property="og:site_name" content="JenkinsDev :: Into the mind of an aspiring polymathic autodidact."><meta property="og:image" content="/img/favicon/blue.png"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:published_time" content="2019-04-30 00:00:00 +0000 UTC"><script async src="https://www.googletagmanager.com/gtag/js?id=G-8HW9H1ENZ4"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-8HW9H1ENZ4")</script></head><body class=blue><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>JenkinsDev</div></a></div><div class=menu-trigger>menu</div></div><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/about>About</a></li><li><a href=/conway.html>Conway's Game of Life (☑️ Edition)</a></li><li><a href=/notes>Public Notes</a></li><li><a href=/showcase>Showcase</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/about>About</a></li><li><a href=/conway.html>Conway's Game of Life (☑️ Edition)</a></li><li><a href=/notes>Public Notes</a></li><li><a href=/showcase>Showcase</a></li></ul></nav></header><div class=content><div class=post><h1 class=post-title><a href=/posts/http-strict-transport-security-and-preloading/>HTTP Strict Transport Security (HSTS) & Preloading</a></h1><div class=post-meta><span class=post-date>2019-04-30
</span><span class=post-reading-time>:: 5 min read (992 words)</span></div><span class=post-tags>#<a href=/tags/hsts/>hsts</a>&nbsp;
#<a href=/tags/https/>https</a>&nbsp;
#<a href=/tags/http-strict-transport-security/>http strict transport security</a>&nbsp;</span><div class=post-content><div><h1 id=your-301-http--https-redirection-isnt-sufficient>Your 301 HTTP → HTTPS Redirection Isn&rsquo;t Sufficient<a href=#your-301-http--https-redirection-isnt-sufficient class=hanchor arialabel=Anchor>&#8983;</a></h1><p>Your end-users are still very much susceptible to &ldquo;man-in-the-middle&rdquo; attacks which could leave them vulnerable to phishing and eavesdropping (we&rsquo;re looking at you NSA) attempts. The issue lies within how browsers handle requests that don&rsquo;t explicity contain a scheme like &ldquo;https://&rdquo; — most default to &ldquo;http://&rdquo;.</p><p>When your browser sends a HTTP request to a site that returns a 301 redirection header, the end-user is still connecting to you – even if for just a second – over an unsecured channel. If they&rsquo;re on public Wi-Fi or they&rsquo;ve been infected with malware, that unsecure request could be intercepted. At which point the malicious actor could then stop the request from ever reaching your server and return a response that looks very much like your own.</p><p>Your non-tech savvy users may not notice that they&rsquo;re not actually connected to your server. They may see a page that looks identical to your own, go to submit their login details, and wind up having their credentials stolen. BAM! Hit with phishing!</p><p>Now, put this into the context of a business such as one in the banking sector&mldr; That&rsquo;d turn into a disaster.</p><p>Before moving forward, I should make a note that what this article covers does not in any way shape or form completely circumvent the possibility of a phishing attempt. This is merely a way to compliment other security measures that should be taken.</p><h1 id=in-comes-http-strict-transport-security>In Comes HTTP Strict Transport Security<a href=#in-comes-http-strict-transport-security class=hanchor arialabel=Anchor>&#8983;</a></h1><p>Thankfully, there is a standard to help us solve this problem. Defined in RFC 6797, the HSTS RFC outlines a HTTP response header that can be returned by your server to tell the user&rsquo;s browser that all future requests MUST be over HTTPS and that it should NEVER connect to your site over plain HTTP.</p><h2 id=just-show-me-how-to-use-it>Just Show Me How To Use It&mldr;<a href=#just-show-me-how-to-use-it class=hanchor arialabel=Anchor>&#8983;</a></h2><p>For those of you that find technical documentation cumbersome to scan through, here&rsquo;s an example of the header:</p><p><code>Strict-Transport-Security: max-age=31536000; includeSubdomains</code></p><p>If you have any clue as to the structure of a HTTP header, this should be pretty self-explanatory. HSTS is defined by the use of the header name Strict-Transport-Security which is accompanied with directives.</p><p>The only directive that is absolutely required is max-age which should be given a value in seconds. This tells the browser how long it should enforce the policy. In the example above we have it set to 1-year.</p><p>The optional includeSubdomains directive isn&rsquo;t accompanied by any values and is handled similar to a boolean, it either exists or it doesn&rsquo;t. If included in your response the HSTS policy will include all subdomains of the host&rsquo;s domain name.</p><h1 id=can-i-revert-these-changes>Can I Revert These Changes?<a href=#can-i-revert-these-changes class=hanchor arialabel=Anchor>&#8983;</a></h1><p>Yes, you can! There are two ways you can have these changes reverted for connecting clients. You can either wait out the time set by stopping the inclusion of the HSTS header and waiting out the max-age you set, from that point. Or, you can have your server respond (over HTTPS!) with another HSTS header, but giving the max-age directive a value of 0.</p><p>See below for an example of removing HSTS from the host and all of its subdomains:</p><p><code>Strict-Transport-Security: max-age=0; includeSubdomains</code></p><h1 id=caveats>Caveats&mldr;<a href=#caveats class=hanchor arialabel=Anchor>&#8983;</a></h1><p>If your site becomes unavailable over HTTPS, a client abiding by the policy will not be able to connect until the max-age has been hit. With this in mind, only ever make use of HSTS if you know for certain you won&rsquo;t be defaulting back to HTTP any time soon.</p><p>It&rsquo;s 2019, generally speaking there&rsquo;s not many circumstances where non-HTTPS should be used!</p><p>Also, another caveat is that any clients that have never connected to your host, or ones that have had their HSTS policy expire will still go through your HTTP → HTTPS redirection for the first request. This isn&rsquo;t a ginormous attack vector, but you can NEVER be too secure. See the section &ldquo;Hardening HSTS&rsquo; Security with Browser Preloading&rdquo; to learn how you can circumvent this step for clients that support preloading.</p><h1 id=browser-support>Browser Support<a href=#browser-support class=hanchor arialabel=Anchor>&#8983;</a></h1><p>As with all things relating to the web, it should come as no suprise that not all browsers support this standard. This isn&rsquo;t your usual JavaScript or CSS lack of support though, there are no real adverse effects on unsupported browsers if you implement.</p><h1 id=hardening-hsts-security-with-browser-preloading>Hardening HSTS&rsquo; Security with Browser Preloading<a href=#hardening-hsts-security-with-browser-preloading class=hanchor arialabel=Anchor>&#8983;</a></h1><p>Now that you have the HSTS header sent in your HTTPS responses, you should be good to go, right? Well&mldr; Yes and no. There&rsquo;s an additional step you can take to help browsers know that your site should NEVER be allowed to be accessed through HTTP. This is called browser preloading and is currently supported by most major browser vendors.</p><p>HSTS preloading is where your domain is hard-coded into the browsers to never be allowed to be accessed via HTTP. You can check and submit your domain by clicking here. In order to be accepted into the preload list you must satisfy a few requirements.</p><ol><li>Serve a valid certificate</li><li>Redirect all requests from HTTP to HTTPS on the same host, if you are listening on port 80</li><li>Serve all subdomains over HTTPS</li><li>Serve an HSTS header on the base domain for HTTPS requests:<ul><li><code>max-age</code> directive must be at least 1-year</li><li>includeSubDomains directive must be included</li><li>A third directive, preload must be included</li><li>Redirections must include HSTS headers as well</li></ul></li></ol><p>Here&rsquo;s a fully qualifying HSTS with preloading header you can use:</p><p><code>Strict-Transport-Security: max-age=31536000; includeSubdomains; preload</code></p><p>Once you have those requirements met, you can use the link above to submit an inclusion request. Once your request has been vetted you&rsquo;ll find your HSTS preload inclusion rolled out generally in one or two browser stable releases (can be dependent on the browser vendor).</p><h1 id=conclusion>Conclusion<a href=#conclusion class=hanchor arialabel=Anchor>&#8983;</a></h1><p>I hope the information provided has been sufficient in helping you wrap your head around why HSTS exists and how to implement it yourself. If you have any questions, comments, or concerns feel free to use the comments section below to include your voice!</p><p>Auf Wiedersehen!</p></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=/posts/remove-all-files-from-git-lfs/><span class=button__icon>←</span>
<span class=button__text>How to remove all files from Git LFS quickly.</span>
</a></span><span class="button next"><a href=/posts/hello-world/><span class=button__text>Hello, World!</span>
<span class=button__icon>→</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2024 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=/assets/main.js></script><script src=/assets/prism.js></script></div></body></html>